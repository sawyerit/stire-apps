$(document).ready(function() {

	function init(event) {
		$("#" + event.target.id).prop('disabled', true);
		$("#info").text("");
	}

	function success(event, data) {
		$("#" + event.target.id).prop('disabled', false);
		if(data)
			$("#info").text(JSON.stringify(data));
	}

	function error(event, data) {
		$("#" + event.target.id).prop('disabled', false);
		if(data)
			$("#info").text(JSON.stringify(data));
	}

	/**
	 * Open a dialog from the sidebar
	 */
	$("#openDialog").click(function() {
		AP.dialog.open({ key: "reference-dialog" });
	});

	/**
	 * Open the app configuration from the sidebar
	 */
	$("#openConfig").click(function() {
		AP.dialog.open({ key: "reference-dialog-config" });
	});

	/**
	 * This is an example of how to call your app back-end from the front-end.
	 * You include a JWT token generated by Stride to:
	 * 1. Validate that the request is coming from your app
	 * 2. Send the context of the query (cloudId, conversationId) to the app back-end
	 */

	/** <----- Trigger Messages ------ > */

	$("#textFormatMessage").click(function(event) {
		init(event);
		AP.auth.withToken(function(err, token) {
			$.ajax({
				type: "POST",
				url: "/messages/textFormat",
				headers: { Authorization: "Bearer " + token },
				dataType: "json",
				success: function(data) {
					success(event, data);
				},
				error: function(data) {
					error(event, data);
				}
			});
		});
	});

	$("#directMessage").click(function(event) {
		init(event);
		AP.auth.withToken(function(err, token) {
			$.ajax({
				type: "POST",
				url: "/messages/direct",
				headers: { Authorization: "Bearer " + token },
				dataType: "json",
				success: function(data) {
					success(event, data);
				},
				error: function(data) {
					error(event, data);
				}
			});
		});
	});

	$("#editMessage").click(function(event) {
		init(event);
		AP.auth.withToken(function(err, token) {
			$.ajax({
				type: "POST",
				url: "/messages/edit",
				headers: { Authorization: "Bearer " + token },
				dataType: "json",
				success: function(data) {
					success(event, data);
				},
				error: function(data) {
					error(event, data);
				}
			});
		});
	});

	$("#deleteMessage").click(function(event) {
		init(event);
		AP.auth.withToken(function(err, token) {
			$.ajax({
				type: "POST",
				url: "/messages/delete",
				headers: { Authorization: "Bearer " + token },
				dataType: "json",
				success: function(data) {
					success(event, data);
				},
				error: function(data) {
					error(event, data);
				}
			});
		});
	});

	$("#userDetails").click(function(event) {
		init(event);
		AP.auth.withToken(function(err, token) {
			$.ajax({
				type: "GET",
				url: "/users/userDetails",
				headers: { Authorization: "Bearer " + token },
				dataType: "json",
				success: function(data) {
					success(event, data);
				},
				error: function(data) {
					error(event, data);
				}
			});
		});
	});

	$("#userMention").click(function(event) {
		init(event);
		AP.auth.withToken(function(err, token) {
			$.ajax({
				type: "GET",
				url: "/users/userMention",
				headers: { Authorization: "Bearer " + token },
				dataType: "json",
				success: function(data) {
					success(event, data);
				},
				error: function(data) {
					error(event, data);
				}
			});
		});
	});

	/** <-----  Actions ------ > */

	$("#actionCard").click(function(event) {
		init(event);
		AP.auth.withToken(function(err, token) {
			$.ajax({
				type: "POST",
				url: "/actions/actionCard",
				headers: { Authorization: "Bearer " + token },
				dataType: "json",
				success: function(data) {
					success(event, data);
				},
				error: function(data) {
					error(event, data);
				}
			});
		});
	});

	$("#updateCard").click(function(event) {
		init(event);
		AP.auth.withToken(function(err, token) {
			$.ajax({
				type: "POST",
				url: "/actions/updateCard",
				headers: { Authorization: "Bearer " + token },
				dataType: "json",
				success: function(data) {
					success(event, data);
				},
				error: function(data) {
					error(event, data);
				}
			});
		});
	});

	/** <----- API: Conversations ------ > */

	$("#getConversationDetails").click(function(event) {
		init(event);
		AP.auth.withToken(function(err, token) {
			$.ajax({
				type: "GET",
				url: "/conversations/getConversationDetails",
				headers: { Authorization: "Bearer " + token },
				dataType: "json",
				success: function(data) {
					success(event, data);
				},
				error: function(data) {
					error(event, data);
				}
			});
		});
	});

	$("#archiveConversation").click(function(event) {
		init(event);
		AP.auth.withToken(function(err, token) {
			$.ajax({
				type: "POST",
				url: "/conversations/archiveConversation",
				headers: { Authorization: "Bearer " + token },
				dataType: "json",
				success: function(data) {
					success(event, data);
				},
				error: function(data) {
					error(event, data);
				}
			});
		});
	});

	$("#unarchiveConversation").click(function(event) {
		init(event);
		AP.auth.withToken(function(err, token) {
			$.ajax({
				type: "POST",
				url: "/conversations/unarchiveConversation",
				headers: { Authorization: "Bearer " + token },
				dataType: "json",
				success: function(data) {
					success(event, data);
				},
				error: function(data) {
					error(event, data);
				}
			});
		});
	});

	/** <-------------------- Trigger Formatted Messages -------------------> */
	$("#richFormatMessage").click(function(event) {
		init(event);
		AP.auth.withToken(function(err, token) {
			$.ajax({
				type: "GET",
				url: "/messages/richFormatMessage",
				headers: { Authorization: "Bearer " + token },
				dataType: "json",
				success: function(data) {
					success(event, data);
				},
				error: function(data) {
					error(event, data);
				}
			});
		});
	});

	/** <-------------------- Trigger Cards -------------------> */

	$("#cardFormatted").click(function(event) {
		init(event);
		AP.auth.withToken(function(err, token) {
			$.ajax({
				type: "POST",
				url: "/actions/formatting",
				headers: { Authorization: "Bearer " + token },
				dataType: "json",
				success: function(data) {
					success(event, data);
				},
				error: function(data) {
					error(event, data);
				}
			});
		});
	});

	/** <-------------------- Trigger Media -------------------> */

	$("#mediaMessage").click(function(event) {
		init(event);
		AP.auth.withToken(function(err, token) {
			$.ajax({
				type: "GET",
				url: "/media/mediaMessage",
				headers: { Authorization: "Bearer " + token },
				dataType: "json",
				success: function(data) {
					success(event, data);
				},
				error: function(data) {
					error(event, data);
				}
			});
		});
	});

	$("#helpMenu").click(function(event) {
		init(event);
		AP.auth.withToken(function(err, token) {
			$.ajax({
				type: "GET",
				url: "/help/menu",
				headers: { Authorization: "Bearer " + token },
				dataType: "json",
				success: function(data) {
					success(event, data);
				},
				error: function(data) {
					error(event, data);
				}
			});
		});
	});

	/**   <------------------ Making an AJAX call from the app front-ent (sidebar, dialog, configuration dialog)
	 to the app back-end in a secured way, using JWT tokens generated via the Stride Javascript API ------------> */

	$("#pingApp").click(function(event) {
		init(event);
		AP.auth.withToken(function(err, token) {
			$.ajax({
				type: "POST",
				url: "/custom/ping",
				headers: { Authorization: "Bearer " + token },
				dataType: "json",
				success: function(data) {
					success(event, data);
				},
				error: function(data) {
					error(event, data);
				}
			});
		});
	});

});
